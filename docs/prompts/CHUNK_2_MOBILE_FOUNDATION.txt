Complete CHUNK 2: Mobile Foundation for VoiceFit 2.0.

Reference the full audit at docs/audits/FULL_PROJECT_AUDIT.md for context.
Reference docs/UI_SPECIFICATION.md for all styling guidelines.

This chunk sets up mobile infrastructure: PowerSync offline sync, authentication OAuth, and the 10-screen onboarding flow.

## PROJECT STRUCTURE

Mobile app: apps/mobile/
- Expo Router file-based routing in apps/mobile/app/
- Auth screens at apps/mobile/app/(auth)/ - login.tsx, signup.tsx, forgot-password.tsx
- Onboarding screens at apps/mobile/app/(onboarding)/ - 10 screens total
- UI components at apps/mobile/src/components/ui/
- Theme at apps/mobile/src/theme/tokens.ts
- Stores at apps/mobile/src/stores/

Backend routers at apps/backend/src/routers/ - use existing tRPC endpoints.

## TASK 2.1: Configure PowerSync Offline Sync

Install PowerSync:
```bash
cd apps/mobile && pnpm add @powersync/react-native @powersync/kysely-driver
```

Create apps/mobile/src/lib/powersync.ts:
```typescript
import { PowerSyncDatabase } from '@powersync/react-native';
import { Kysely } from 'kysely';

// Define sync rules for tables
export const SYNC_TABLES = [
  'workouts',
  'workout_sets',
  'exercises',
  'runs',
  'run_splits',
  'readiness_logs',
  'injuries',
  'nutrition_logs',
  'shoes',
  'programs',
  'program_workouts',
  'badges',
];

// Schema definition for PowerSync
const schema = new Schema([
  // Define tables with their columns - reference apps/backend/src/db/schema/*.ts for structure
]);

export const powerSync = new PowerSyncDatabase({
  schema,
  database: {
    dbFilename: 'voicefit.db',
  },
});

// Conflict resolution: last-write-wins based on updated_at timestamp
export const resolveConflict = (local: any, remote: any) => {
  const localTime = new Date(local.updated_at).getTime();
  const remoteTime = new Date(remote.updated_at).getTime();
  return remoteTime > localTime ? remote : local;
};
```

Create apps/mobile/src/components/common/ConnectionStatus.tsx:
```typescript
// Show connection indicator - green dot when online, yellow when syncing, red when offline
// Use @react-native-community/netinfo to detect connection state
// Position in top-right corner of screen
```

Install netinfo:
```bash
cd apps/mobile && pnpm add @react-native-community/netinfo
```

Create apps/mobile/src/hooks/useOfflineAware.ts:
```typescript
// Hook that returns { isOnline, isSyncing, lastSyncTime }
// Uses netinfo and PowerSync sync status
```

## TASK 2.2: Complete Authentication with OAuth

The auth screens at apps/mobile/app/(auth)/ already exist but need OAuth implementation.

In apps/mobile/app/(auth)/signup.tsx:
- Add Apple OAuth button using expo-apple-authentication
- Add Google OAuth button using expo-auth-session
- Add terms/privacy checkbox (required to proceed)
- Connect to Supabase Auth via the auth store

In apps/mobile/app/(auth)/login.tsx:
- Add Apple OAuth button
- Add Google OAuth button
- The email/password flow already works

Install dependencies:
```bash
cd apps/mobile && pnpm add expo-apple-authentication expo-auth-session expo-crypto
```

Update apps/mobile/src/stores/auth.ts:
- Add signInWithApple() method
- Add signInWithGoogle() method
- Both should use Supabase OAuth providers

## TASK 2.3: Complete 10-Screen Onboarding Flow

All screens exist at apps/mobile/app/(onboarding)/ but need to be connected to tRPC.

The onboarding store is at apps/mobile/src/stores/onboarding.ts - use it to track progress.

Each screen MUST:
1. Use UI_SPECIFICATION.md styling (colors, spacing, typography from tokens.ts)
2. Show progress indicator (current step / total steps)
3. Save data to the store and allow back navigation
4. Validate inputs before allowing "Continue"

Screen checklist with specific requirements:

1. index.tsx (Welcome) - DONE, already works

2. goals.tsx - Multi-select fitness goals
   - Options: Build Muscle, Lose Weight, Get Stronger, Improve Endurance, General Fitness, Sport Performance
   - Minimum 1 selection required
   - Save to onboardingStore.goals[]

3. activities.tsx - Multi-select activities
   - Options: Weight Training, Running, CrossFit, Bodyweight, Cycling, Swimming, Yoga, Other
   - Minimum 1 selection required
   - Save to onboardingStore.activities[]

4. equipment.tsx - Multi-select available equipment
   - Options: Full Gym, Home Dumbbells, Barbell & Rack, Bodyweight Only, Resistance Bands, Kettlebells
   - Save to onboardingStore.equipment[]

5. experience.tsx - Single select experience level
   - Options: Beginner (<1 year), Intermediate (1-3 years), Advanced (3+ years)
   - Save to onboardingStore.experienceLevel

6. frequency.tsx - Training frequency selector
   - Slider or button group: 2, 3, 4, 5, 6 days per week
   - Save to onboardingStore.trainingDaysPerWeek

7. limitations.tsx - Injury/limitation input
   - Text input for injuries or physical limitations
   - Optional field
   - Save to onboardingStore.limitations

8. notifications.tsx - Notification permission request
   - Request push notification permission using expo-notifications
   - Show skip option if user declines
   - Save preference to onboardingStore.notificationsEnabled

9. voice-tutorial.tsx - Voice logging tutorial
   - Show animated demo of voice logging
   - "Try it now" button to test microphone
   - Can be skipped

10. complete.tsx - Completion celebration
    - Show confetti animation using react-native-confetti-cannon
    - "Start Training" button
    - Call tRPC mutation to save all onboarding data: api.onboarding.complete.useMutation()

Install dependencies:
```bash
cd apps/mobile && pnpm add expo-notifications react-native-confetti-cannon
```

After completion, navigate to /(tabs) main app.

## TASK 2.4: Wire Onboarding to Backend

The backend already has apps/backend/src/routers/onboarding.ts with endpoints.

In the completion screen (complete.tsx):
1. Collect all data from onboardingStore
2. Call the tRPC endpoint to save profile data
3. Handle errors gracefully with Toast component
4. Navigate to main app on success

Example mutation call:
```typescript
const completeMutation = api.onboarding.complete.useMutation({
  onSuccess: () => {
    router.replace('/(tabs)');
  },
  onError: (error) => {
    setToast({ visible: true, message: error.message, type: 'error' });
  },
});
```

## TASK 2.5: Add Missing UI Component Props

In apps/mobile/src/components/ui/Button.tsx:
- Ensure `style?: StyleProp<ViewStyle>` prop exists
- Ensure `children` can be ReactNode (not just string)

In apps/mobile/src/components/ui/Input.tsx:
- Ensure `autoFocus?: boolean` prop exists

## VALIDATION CRITERIA

This chunk is complete when:
1. PowerSync is configured with sync rules for 12 tables
2. ConnectionStatus component shows online/offline state
3. Apple and Google OAuth work on signup/login screens
4. All 10 onboarding screens render correctly and navigate properly
5. Onboarding data saves to backend on completion
6. App compiles without TypeScript errors

Test by running:
```bash
cd apps/mobile && npx expo start --ios
```

Navigate through the full auth and onboarding flow manually.
